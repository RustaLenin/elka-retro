# Анализ Overlay и Loader при создании заказа

## Текущая реализация

### ✅ Что есть:
1. **Overlay с loader** - показывается при `isSubmitting: true`
2. **Блокировка кнопки** - кнопка "Завершить заказ" становится `disabled`
3. **Визуальная обратная связь** - loader с текстом "Создание заказа..."

### ❌ Проблемы:

#### 1. Overlay покрывает только содержимое шага
- **Текущее положение:** Overlay находится внутри `.step-confirmation` (position: absolute относительно `.step-confirmation`)
- **Проблема:** Overlay НЕ покрывает:
  - Header визарда (заголовок "Оформление заказа")
  - Progress bar (шаги 1-5)
  - Footer визарда (кнопки "Назад" и "Завершить заказ")
- **Результат:** Пользователь может видеть и взаимодействовать с элементами визарда, что может быть нежелательно

#### 2. Нет блокировки прокрутки страницы
- Пользователь может прокручивать страницу во время создания заказа
- Overlay может "уехать" при прокрутке

#### 3. z-index может быть недостаточным
- Текущий z-index: 1000
- Могут быть другие элементы с более высоким z-index

#### 4. Нет блокировки взаимодействия с элементами вне overlay
- Пользователь может кликать на элементы страницы вне визарда

---

## Предложения по улучшению

### Вариант 1: Overlay на уровне визарда (рекомендуется)

**Преимущества:**
- Покрывает весь визард (header, content, footer)
- Более очевидно для пользователя, что процесс идет
- Легче контролировать блокировку взаимодействия

**Реализация:**
1. Переместить overlay из `step-confirmation-template.js` в `order-wizard-template.js`
2. Показывать overlay на уровне `.order-wizard` когда `isSubmitting: true`
3. Overlay должен покрывать весь визард (position: absolute относительно `.order-wizard`)

### Вариант 2: Overlay на уровне страницы (максимальная блокировка)

**Преимущества:**
- Полная блокировка всей страницы
- Невозможно взаимодействовать ни с чем

**Недостатки:**
- Может быть избыточно
- Сложнее реализовать

### Дополнительные улучшения:

1. **Блокировка прокрутки:**
   - Добавить `overflow: hidden` на `body` при показе overlay
   - Убрать при скрытии overlay

2. **Улучшенные сообщения о прогрессе:**
   - "Подготовка данных..."
   - "Отправка на сервер..."
   - "Обработка заказа..."
   - "Отправка уведомлений..."

3. **Анимация появления:**
   - Плавное появление overlay (fade-in)
   - Плавное исчезновение (fade-out)

4. **Блокировка всех кликов:**
   - `pointer-events: none` на всех элементах визарда при overlay
   - Или `pointer-events: auto` только на overlay

---

## Реализованное решение

✅ **Вариант 1** (overlay на уровне визарда) с дополнительными улучшениями:

### Что реализовано:

1. ✅ **Overlay на уровне визарда**
   - Перемещен из `step-confirmation-template.js` в `order-wizard-template.js`
   - Покрывает весь визард (header, content, footer)
   - Position: absolute относительно `.order-wizard`

2. ✅ **Блокировка прокрутки страницы**
   - При показе overlay: `document.body.style.overflow = 'hidden'`
   - При скрытии overlay: восстановление исходного значения
   - Реализовано в `order-wizard.js` → `onStateChanged('isSubmitting')`

3. ✅ **Блокировка взаимодействия**
   - `pointer-events: none` на элементах визарда при overlay
   - `user-select: none` для предотвращения выделения текста
   - Overlay имеет `pointer-events: auto` для отображения loader

4. ✅ **Улучшенный дизайн overlay**
   - Более темный фон (rgba(0, 0, 0, 0.8))
   - Усиленный blur (6px)
   - Более крупный loader (3.5rem)
   - Дополнительная подсказка: "Пожалуйста, не закрывайте страницу"
   - Плавная анимация появления (fadeIn 0.2s)

5. ✅ **Высокий z-index**
   - z-index: 10000 для гарантированного отображения поверх всех элементов

### Структура overlay:

```html
<div class="order-wizard_overlay">
  <div class="order-wizard_loader">
    <ui-icon name="loader" size="large" spin></ui-icon>
    <p class="order-wizard_loader-text">Создание заказа...</p>
    <p class="order-wizard_loader-hint">Пожалуйста, не закрывайте страницу</p>
  </div>
</div>
```

### Преимущества реализации:

1. ✅ **Полная блокировка визарда** - пользователь не может взаимодействовать ни с чем
2. ✅ **Очевидная обратная связь** - overlay покрывает весь визард, невозможно пропустить
3. ✅ **Блокировка прокрутки** - overlay не "уедет" при прокрутке
4. ✅ **Профессиональный вид** - плавные анимации, улучшенный дизайн
5. ✅ **Информативность** - подсказка о том, что не нужно закрывать страницу

### Дополнительные возможности (на будущее):

1. **Детальные сообщения о прогрессе:**
   - "Подготовка данных..."
   - "Отправка на сервер..."
   - "Обработка заказа..."
   - "Отправка уведомлений..."
   
   *Можно реализовать через отслеживание этапов в `createOrder()`*

2. **Прогресс-бар:**
   - Визуальный индикатор прогресса (0-100%)
   - Показывает, на каком этапе находится обработка
   
   *Требует изменений в backend для отслеживания прогресса*

