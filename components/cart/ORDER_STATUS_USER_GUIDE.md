# Статусы заказов — пользовательская документация

## Общая концепция

Система управления статусами заказов использует **двухуровневую структуру**:

1. **Операционный статус** (`post_status`) — определяет, требует ли заказ работы:
   - `publish` — заказ актуален, требует работы
   - `completed` — заказ завершён (успешно выполнен)
   - `rejected` — заказ отклонён/отменён (не выполнен)

2. **Бизнес-статус** (`order_status`) — детальная информация о состоянии заказа и требуемых действиях

Такое разделение позволяет:
- Чётко разделять актуальные заказы (требуют работы), завершённые и отклонённые (исторические данные)
- Гибко управлять детальными статусами без конфликтов с системой WordPress
- Легко фильтровать и отображать заказы в админке (в будущем)

---

## Статусы заказов

### Актуальные заказы (требуют работы)

#### 1. Ожидает подтверждения (`pending_confirmation`)

**Что происходит:**
- Администратор собирает заказ
- Проверяет, что со всеми игрушками всё в порядке
- Упаковывает заказ

**Следующий шаг:**
- После проверки и упаковки заказ переходит в статус "Ожидает оплаты" (если требуется оплата)
- Или сразу в статус "Ожидает отправки" (для самовывоза с Удельной без предоплаты)

---

#### 2. Ожидает оплаты (`awaiting_payment`)

**Что происходит:**
- Заказ собран, проверен и упакован
- Клиенту остаётся только оплатить заказ

**Следующий шаг:**
- После оплаты заказ переходит в статус "Ожидает отправки"

**Особенность:**
- Для самовывоза с Удельной этот статус может быть пропущен (оплата при получении)

---

#### 3. Ожидает отправки (`awaiting_shippment`)

**Что происходит:**
- Заказ оплачен (или готов к получению для самовывоза)
- Готов к отправке курьером, почтой или в пункт выдачи
- Или готов к отправке в магазин на Удельной

**Следующий шаг:**
- После отправки заказ переходит в статус "Отправлен" (для доставки)
- Или в статус "Ожидает получения" (для самовывоза с Удельной)

---

#### 4. Отправлен (`shipped`)

**Что происходит:**
- Заказ отправлен клиенту (курьером, почтой или в пункт выдачи)
- Ожидает получения клиентом

**Следующий шаг:**
- После получения заказ переходит в статус "Завершён" и закрывается

---

#### 5. Ожидает получения (`awaiting_pickup`)

**Что происходит:**
- Заказ готов к получению в магазине на Удельной
- Клиент может забрать заказ в магазине

**Следующий шаг:**
- После получения заказ переходит в статус "Завершён" и закрывается

**Особенность:**
- Используется только для самовывоза с Удельной

---

#### 6. Уточнение у клиента (`clarification`)

**Что происходит:**
- Требуется уточнение информации у клиента
- Заказ временно приостановлен

**Следующий шаг:**
- После получения уточнений заказ возвращается к предыдущему статусу

---

### Завершённые заказы (исторические данные)

#### 1. Завершён (`completed`)

**Операционный статус:** `post_status = completed`

**Что происходит:**
- Заказ успешно выполнен и получен клиентом
- Заказ завершён, больше не требует действий

---

### Отклонённые заказы (исторические данные)

#### 1. Отклонён магазином (`rejected`)

**Операционный статус:** `post_status = rejected`  
**Бизнес-статус:** `order_status = rejected`

**Что происходит:**
- Заказ отклонён магазином (например, клиент неадекватный)
- Заказ не выполнен, больше не требует действий

---

#### 2. Отменён клиентом (`cancelled`)

**Операционный статус:** `post_status = rejected`  
**Бизнес-статус:** `order_status = cancelled`

**Что происходит:**
- Заказ отменён клиентом
- Клиент может отменить заказ только до оплаты (оплата — это точка принятия обязательств магазином на поставку)
- Заказ не выполнен, больше не требует действий

---

## Типовые сценарии работы с заказами

### Сценарий 1: Стандартный заказ с доставкой (требуется оплата)

```
1. Ожидает подтверждения
   ↓ (администратор собирает, проверяет, упаковывает)
2. Ожидает оплаты
   ↓ (клиент оплачивает)
3. Ожидает отправки
   ↓ (отправка курьером/почтой/в пункт выдачи)
4. Отправлен
   ↓ (клиент получает заказ)
5. Завершён (`post_status = completed`)
```

### Сценарий 2: Самовывоз с Удельной (оплата при получении)

```
1. Ожидает подтверждения
   ↓ (администратор собирает, проверяет, упаковывает)
2. Ожидает отправки (готов к получению)
   ↓ (заказ готов к получению в магазине)
3. Ожидает получения
   ↓ (клиент забирает заказ и оплачивает при получении)
4. Завершён → закрыт
```

### Сценарий 3: Самовывоз с Удельной (предоплата)

```
1. Ожидает подтверждения
   ↓ (администратор собирает, проверяет, упаковывает)
2. Ожидает оплаты
   ↓ (клиент оплачивает заранее)
3. Ожидает отправки (готов к получению)
   ↓ (заказ готов к получению в магазине)
4. Ожидает получения
   ↓ (клиент забирает заказ)
5. Завершён (`post_status = completed`)
```

---

## Планы на будущее: Споры (Disputes)

### Концепция

**Спор** — отдельная сущность для разрешения конфликтных ситуаций с закрытыми заказами.

**Основные принципы:**
- Заказ остаётся завершённым или отклонённым (исторические данные сохраняются)
- Спор создаётся как новая сущность, привязанная к завершённому или отклонённому заказу
- По итогу спора магазин может вернуть средства или не вернуть
- Если пользователь не доказал ответственность магазина — средства не возвращаются

### Статусы спора

1. **Ожидает рассмотрения** (`pending`) — спор создан, ожидает рассмотрения администратором
2. **На рассмотрении** (`in_review`) — администратор рассматривает спор
3. **Разрешён** (`resolved`) — спор разрешён в пользу клиента, средства возвращены
4. **Отклонён** (`rejected`) — спор отклонён, средства не возвращены

### Сценарии работы со спорами

#### Сценарий 1: Спор разрешён в пользу клиента

1. Клиент создаёт спор по закрытому заказу
2. Администратор рассматривает спор
3. Если магазин признаёт ответственность:
   - Спор получает статус "Разрешён"
   - Средства возвращаются клиенту
   - Может быть создан новый заказ (компенсация)

#### Сценарий 2: Спор отклонён

1. Клиент создаёт спор по закрытому заказу
2. Администратор рассматривает спор
3. Если клиент не доказал ответственность магазина:
   - Спор получает статус "Отклонён"
   - Средства не возвращаются
   - Заказ остаётся завершённым или отклонённым

### Компенсационные заказы

Если по итогу спора магазин признаёт ответственность, может быть создан **новый заказ-компенсация**:

- Полностью за счёт магазина (не требует оплаты)
- Проходит через те же этапы обработки, что и обычный заказ
- Привязан к спору и оригинальному заказу для отслеживания

---

## Важные моменты

### Разделение операционного и бизнес-статуса

- **Операционный статус** (`post_status`) определяет, требует ли заказ работы
- **Бизнес-статус** (`order_status`) определяет, какая именно работа требуется
- Такое разделение позволяет гибко управлять заказами без конфликтов с системой

### Завершённые и отклонённые заказы

- Завершённые заказы (`post_status = completed`) не требуют работы
- Отклонённые заказы (`post_status = rejected`) не требуют работы
- Они остаются в системе как исторические данные
- К завершённым и отклонённым заказам можно привязать споры для разрешения конфликтных ситуаций

### Возврат заказа в работу

- **Не предусмотрен** — заказ остаётся завершённым или отклонённым
- Вместо возврата используются:
  - **Споры** — для разрешения конфликтных ситуаций
  - **Новые заказы** — для компенсации клиенту (если требуется)

---

## Резюме

Система статусов заказов построена на принципе разделения операционного состояния и бизнес-логики:

- **Операционный статус** — актуален заказ, завершён или отклонён
- **Бизнес-статус** — детальная информация о состоянии и требуемых действиях

Такая структура обеспечивает:
- ✅ Гибкость управления заказами
- ✅ Сохранение исторических данных
- ✅ Возможность разрешения конфликтных ситуаций через споры
- ✅ Масштабируемость для будущих улучшений

