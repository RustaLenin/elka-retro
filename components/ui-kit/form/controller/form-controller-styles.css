/* Form Controller Styles */

/* ⚠️ ВАЖНО: Web Component - это элемент, а не класс! Селектор БЕЗ точки */
/* Основной контейнер формы */
ui-form-controller {
  display: flex;
  flex-direction: column;
  width: 100%;
  gap: 24px;
}

/* Header */
.ui-form-controller__header {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--form-border, var(--color-border-accent));
}

.ui-form-controller__header[hidden] {
  display: none;
}

.ui-form-controller__header-icon {
  flex-shrink: 0;
  margin-top: 4px;
}

.ui-form-controller__header-content {
  flex: 1 1 auto;
}

.ui-form-controller__title {
  margin: 0 0 8px 0;
  font-family: var(--font-heading);
  font-size: 24px;
  font-weight: 600;
  line-height: 1.3;
  color: var(--color-foreground, #f5f7fa);
}

.ui-form-controller__description {
  margin: 0;
  font-size: 14px;
  line-height: 1.5;
  color: var(--color-muted-foreground, #8a8f99);
}

/* Status */
.ui-form-controller__status {
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 14px;
  line-height: 1.5;
}

.ui-form-controller__status[data-status="idle"] {
  display: none;
}

.ui-form-controller__status[data-status="validating"] {
  background: var(--form-status-info-bg, #eff8ff);
  border: 1px solid var(--form-status-info-border, #b2ddff);
  color: var(--form-status-info-text, #004085);
}

.ui-form-controller__status[data-status="submitting"] {
  background: var(--form-status-info-bg, #eff8ff);
  border: 1px solid var(--form-status-info-border, #b2ddff);
  color: var(--form-status-info-text, #004085);
}

.ui-form-controller__status[data-status="success"] {
  background: var(--form-status-success-bg, #ecfdf3);
  border: 1px solid var(--form-status-success-border, #a6f4c5);
  color: var(--form-status-success-text, #027a48);
}

.ui-form-controller__status[data-status="error"] {
  background: var(--form-status-error-bg, #fef3f2);
  border: 1px solid var(--form-status-error-border, #fecdca);
  color: var(--form-status-error-text, #b42318);
}

.ui-form-controller__status-message {
  margin: 0 0 8px 0;
  font-weight: 500;
}

.ui-form-controller__status-details {
  margin: 0;
  padding-left: 20px;
  list-style: disc;
}

.ui-form-controller__status-details li {
  margin-bottom: 4px;
}

/* Body */
.ui-form-controller__body {
  flex: 1 1 auto;
}

/* Фон применяется только если атрибут background присутствует */
ui-form-controller[background] .ui-form-controller__body {
  padding: 24px;
  border-radius: 12px;
  border: 1px solid var(--color-border, #2a2d31);
  background: var(--color-card, #17181d);
}

/* Если атрибута нет - фон прозрачный */
ui-form-controller:not([background]) .ui-form-controller__body {
  background: transparent;
  border: none;
  padding: 0;
}

.ui-form-controller__layout {
  display: flex;
  flex-direction: column;
  gap: var(--ui-form-layout-gap, 24px);
  width: 100%;
}

/* Layout: Columns */
.ui-form-controller__columns-wrapper,
.ui-form-controller__groups-wrapper {
  display: grid;
  gap: var(--ui-form-layout-gap, 24px);
  width: 100%;
}

.ui-form-controller__layout--columns-1 {
  grid-template-columns: 1fr;
}

.ui-form-controller__layout--columns-2 {
  grid-template-columns: repeat(2, 1fr);
}

.ui-form-controller__layout--columns-3 {
  grid-template-columns: repeat(3, 1fr);
}

/* Layout: Groups */
.ui-form-controller__group {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 20px;
  border: 1px solid var(--form-group-border, #e4e7ec);
  border-radius: 12px;
  background: var(--form-group-bg, #ffffff);
}

.ui-form-controller__group-header {
  margin-bottom: 8px;
}

.ui-form-controller__group-title {
  margin: 0 0 4px 0;
  font-size: 18px;
  font-weight: 600;
  line-height: 1.3;
  color: var(--form-group-title, #101828);
}

.ui-form-controller__group-description {
  margin: 0;
  font-size: 14px;
  line-height: 1.5;
  color: var(--form-group-description, #475467);
}

.ui-form-controller__group-fields {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* Layout: Steps (Wizard) */
.ui-form-controller__steps-wrapper {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.ui-form-controller__steps-header {
  display: flex;
  gap: 8px;
  padding-bottom: 16px;
  border-bottom: 2px solid var(--form-steps-border, #e4e7ec);
  overflow-x: auto;
}

.ui-form-controller__step-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  color: var(--form-step-inactive, #98a2b3);
  background: transparent;
  transition: all 0.2s ease;
  white-space: nowrap;
  cursor: pointer;
  flex-shrink: 0;
}

.ui-form-controller__step-indicator:hover {
  background: var(--form-step-hover, #f9fafb);
}

.ui-form-controller__step-indicator[data-active="true"] {
  color: var(--form-step-active, #155eef);
  background: var(--form-step-active-bg, #eff8ff);
  font-weight: 600;
}

.ui-form-controller__step-indicator[data-completed="true"] {
  color: var(--form-step-completed, #039855);
}

.ui-form-controller__step-indicator-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: currentColor;
  color: #ffffff;
  font-size: 12px;
  font-weight: 600;
  line-height: 1;
}

.ui-form-controller__step-indicator[data-active="true"] .ui-form-controller__step-indicator-number {
  background: var(--form-step-active, #155eef);
}

.ui-form-controller__step-indicator[data-completed="true"] .ui-form-controller__step-indicator-number {
  background: var(--form-step-completed, #039855);
}

.ui-form-controller__step-indicator-label {
  display: none;
}

@media (min-width: 640px) {
  .ui-form-controller__step-indicator-label {
    display: inline;
  }
}

.ui-form-controller__steps-content {
  display: flex;
  flex-direction: column;
  gap: 24px;
  min-height: 200px;
}

.ui-form-controller__step {
  display: none;
  flex-direction: column;
  gap: 20px;
}

.ui-form-controller__step[data-active="true"] {
  display: flex;
}

.ui-form-controller__step-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--form-step-border, #e4e7ec);
}

.ui-form-controller__step-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--form-step-active, #155eef);
  color: #ffffff;
  font-size: 16px;
  font-weight: 600;
  line-height: 1;
  flex-shrink: 0;
}

.ui-form-controller__step-info {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.ui-form-controller__step-label {
  font-size: 18px;
  font-weight: 600;
  line-height: 1.3;
  color: var(--form-step-label, #101828);
}

.ui-form-controller__step-description {
  font-size: 14px;
  line-height: 1.5;
  color: var(--form-step-description, #475467);
}

.ui-form-controller__step-content {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* Actions */
.ui-form-controller__actions {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 12px;
  padding-top: 16px;
  border-top: 1px solid var(--form-border, #e4e7ec);
  flex-wrap: wrap;
}

.ui-form-controller__button {
  flex-shrink: 0;
}

.ui-form-controller__button[data-visible-when="debug"] {
  display: none;
}

ui-form-controller[data-debug="true"] .ui-form-controller__button[data-visible-when="debug"] {
  display: inline-flex;
}

/* Loading overlay */
form.ui-form-controller {
  position: relative;
}

.ui-form-controller__overlay {
  position: absolute;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(15, 23, 42, 0.65);
  backdrop-filter: blur(3px);
  border-radius: inherit;
  z-index: 10;
  pointer-events: none;
}

/* В модальном режиме overlay создается внутри modal_body и покрывает весь modal_body */
/* modal_body уже имеет position: relative в modal-styles.css */
.modal_body .ui-form-controller__overlay {
  /* Overlay позиционируется относительно modal_body (который имеет position: relative) */
  position: absolute;
  inset: 0;
  z-index: 100; /* Выше содержимого модального окна */
}

.ui-form-controller__overlay--visible {
  display: flex;
  pointer-events: all;
}

.ui-form-controller__overlay-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  padding: 24px 32px;
  border-radius: 16px;
  background: rgba(12, 16, 27, 0.85);
  color: #fff;
  text-align: center;
  min-width: 220px;
}

.ui-form-controller__overlay-content block-loader {
  --loader-color: var(--color-primary, #a855f7);
}

.ui-form-controller__overlay-label {
  margin: 0;
  font-size: 14px;
  line-height: 1.4;
}

/* Debug Panel */
.ui-form-controller__debug {
  padding: 20px;
  border: 1px solid var(--form-debug-border, #d0d5dd);
  border-radius: 8px;
  background: var(--form-debug-bg, #f9fafb);
  font-family: 'Courier New', monospace;
  font-size: 12px;
  line-height: 1.5;
}

.ui-form-controller__debug-block {
  margin-bottom: 16px;
}

.ui-form-controller__debug-block:last-child {
  margin-bottom: 0;
}

.ui-form-controller__debug-block summary {
  padding: 8px 12px;
  background: var(--form-debug-summary-bg, #ffffff);
  border: 1px solid var(--form-debug-border, #d0d5dd);
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  user-select: none;
}

.ui-form-controller__debug-block summary:hover {
  background: var(--form-debug-summary-hover, #f9fafb);
}

.ui-form-controller__debug-state,
.ui-form-controller__debug-payload,
.ui-form-controller__debug-validation {
  margin: 12px 0 0 0;
  padding: 12px;
  background: #ffffff;
  border: 1px solid var(--form-debug-border, #d0d5dd);
  border-radius: 6px;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
  max-height: 400px;
  overflow-y: auto;
}

/* Responsive */
@media (max-width: 768px) {
  .ui-form-controller__layout--columns-2,
  .ui-form-controller__layout--columns-3 {
    grid-template-columns: 1fr;
  }

  .ui-form-controller__actions {
    flex-direction: column;
    align-items: stretch;
  }

  .ui-form-controller__button {
    width: 100%;
  }

  .ui-form-controller__steps-header {
    gap: 4px;
  }

  .ui-form-controller__step-indicator {
    padding: 8px 12px;
    font-size: 12px;
  }
}

@media (max-width: 480px) {
  .ui-form-controller {
    gap: 16px;
  }

  .ui-form-controller__group {
    padding: 16px;
  }

  .ui-form-controller__title {
    font-size: 20px;
  }
}
